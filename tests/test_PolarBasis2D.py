import numpy as np
from unittest import TestCase

from aspire.basis.polar_2d import PolarBasis2D


class PolarBasis2DTestCase(TestCase):
    def setUp(self):
        self.basis = PolarBasis2D((8, 8), 4, 32)

    def tearDown(self):
        pass

    def testPolarBasis2DEvaluate_t(self):
        x = np.array([
            [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
             -1.08106869e-17,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
            [ 0.00000000e+00,  0.00000000e+00, -6.40456062e-03, -3.32961020e-03,
             -1.36887927e-02, -5.42770488e-03,  7.63680861e-03,  0.00000000e+00],
            [ 0.00000000e+00,  3.16377602e-03, -9.31273350e-03,  9.46128404e-03,
              1.93239220e-02,  3.79891953e-02,  1.06841173e-02, -2.36467925e-03],
            [ 0.00000000e+00,  1.72736955e-03, -1.00710814e-02,  4.93520304e-02,
              3.77702656e-02,  6.57365438e-02,  3.94739462e-03, -4.41228496e-03],
            [ 4.01551066e-18, -3.08071647e-03, -1.61670565e-02,  8.66886286e-02,
              5.09898409e-02,  7.19313349e-02,  1.68313715e-02,  5.19180892e-03],
            [ 0.00000000e+00,  2.87262215e-03, -3.37732956e-02,  4.51706505e-02,
              5.72215879e-02,  4.63553081e-02,  1.86552175e-03,  1.12608805e-02],
            [ 0.00000000e+00,  2.77905016e-03, -2.77499404e-02, -4.02645374e-02,
             -1.54969139e-02, -1.66229153e-02, -2.07389259e-02,  6.64060546e-03],
            [ 0.00000000e+00,  0.00000000e+00,  5.20080934e-03, -1.06788196e-02,
             -1.14761672e-02, -1.27443126e-02, -1.15563484e-02,  0.00000000e+00]
        ])
        pf = self.basis.evaluate_t(x)

        result = np.array([
            0.03380247-5.89204076e-19j,  0.02872018+1.30672514e-02j,
            0.01309842-3.34259247e-04j, -0.02016014-4.67873936e-03j,
            0.03380247-5.89204076e-19j,  0.03057796+9.40057671e-03j,
            0.01371724+4.20376894e-03j, -0.01980004-3.82835342e-04j,
            0.03380247-5.89204076e-19j,  0.03266583+5.03438558e-03j,
            0.01537014+4.89228077e-03j, -0.01025435+1.19682839e-03j,
            0.03380247-5.89204076e-19j,  0.03451127+1.92608768e-04j,
            0.01603935+1.21170869e-03j, -0.00186512-5.87845707e-04j,
            0.03380247-5.89204076e-19j,  0.03592098-4.60817041e-03j,
            0.01385417-3.41016088e-03j, -0.00255115-3.46031202e-03j,
            0.03380247-5.89204076e-19j,  0.03701039-8.82952664e-03j,
            0.01048505-4.55405009e-03j, -0.00468348-1.72639659e-03j,
            0.03380247-5.89204076e-19j,  0.03801901-1.22247975e-02j,
            0.0089058 -1.11094686e-03j, -0.00358214+5.01041279e-03j,
            0.03380247-5.89204076e-19j,  0.03901859-1.49223378e-02j,
            0.01011694+4.00402639e-03j, -0.00313471+1.00359793e-02j,
            0.03380247-5.89204076e-19j,  0.03973949-1.72176019e-02j,
            0.01330573+7.17638522e-03j, -0.00424313+1.02379166e-02j,
            0.03380247-5.89204076e-19j,  0.03966191-1.92649092e-02j,
            0.01689709+7.06696989e-03j, -0.00502319+8.59333664e-03j,
            0.03380247-5.89204076e-19j,  0.03834236-2.09198645e-02j,
            0.01858398+4.84780422e-03j, -0.00470122+7.55674423e-03j,
            0.03380247-5.89204076e-19j,  0.03578453-2.18384167e-02j,
            0.01651114+2.93242588e-03j, -0.00589918+7.01994921e-03j,
            0.03380247-5.89204076e-19j,  0.03258512-2.17359116e-02j,
            0.01207456+3.26106474e-03j, -0.01013553+7.50592900e-03j,
            0.03380247-5.89204076e-19j,  0.02969585-2.05919593e-02j,
            0.00948282+5.52149782e-03j, -0.01143088+9.38150684e-03j,
            0.03380247-5.89204076e-19j,  0.02794545-1.86315376e-02j,
            0.01049781+7.01637729e-03j, -0.009674  +1.06207302e-02j,
            0.03380247-5.89204076e-19j,  0.02767791-1.61035081e-02j,
            0.01244108+5.17635235e-03j, -0.01343395+9.02947047e-03j,
            0.03380247+5.89204076e-19j,  0.02872018-1.30672514e-02j,
            0.01309842+3.34259247e-04j, -0.02016014+4.67873936e-03j,
            0.03380247+5.89204076e-19j,  0.03057796-9.40057671e-03j,
            0.01371724-4.20376894e-03j, -0.01980004+3.82835342e-04j,
            0.03380247+5.89204076e-19j,  0.03266583-5.03438558e-03j,
            0.01537014-4.89228077e-03j, -0.01025435-1.19682839e-03j,
            0.03380247+5.89204076e-19j,  0.03451127-1.92608768e-04j,
            0.01603935-1.21170869e-03j, -0.00186512+5.87845707e-04j,
            0.03380247+5.89204076e-19j,  0.03592098+4.60817041e-03j,
            0.01385417+3.41016088e-03j, -0.00255115+3.46031202e-03j,
            0.03380247+5.89204076e-19j,  0.03701039+8.82952664e-03j,
            0.01048505+4.55405009e-03j, -0.00468348+1.72639659e-03j,
            0.03380247+5.89204076e-19j,  0.03801901+1.22247975e-02j,
            0.0089058 +1.11094686e-03j, -0.00358214-5.01041279e-03j,
            0.03380247+5.89204076e-19j,  0.03901859+1.49223378e-02j,
            0.01011694-4.00402639e-03j, -0.00313471-1.00359793e-02j,
            0.03380247+5.89204076e-19j,  0.03973949+1.72176019e-02j,
            0.01330573-7.17638522e-03j, -0.00424313-1.02379166e-02j,
            0.03380247+5.89204076e-19j,  0.03966191+1.92649092e-02j,
            0.01689709-7.06696989e-03j, -0.00502319-8.59333664e-03j,
            0.03380247+5.89204076e-19j,  0.03834236+2.09198645e-02j,
            0.01858398-4.84780422e-03j, -0.00470122-7.55674423e-03j,
            0.03380247+5.89204076e-19j,  0.03578453+2.18384167e-02j,
            0.01651114-2.93242588e-03j, -0.00589918-7.01994921e-03j,
            0.03380247+5.89204076e-19j,  0.03258512+2.17359116e-02j,
            0.01207456-3.26106474e-03j, -0.01013553-7.50592900e-03j,
            0.03380247+5.89204076e-19j,  0.02969585+2.05919593e-02j,
            0.00948282-5.52149782e-03j, -0.01143088-9.38150684e-03j,
            0.03380247+5.89204076e-19j,  0.02794545+1.86315376e-02j,
            0.01049781-7.01637729e-03j, -0.009674  -1.06207302e-02j,
            0.03380247+5.89204076e-19j,  0.02767791+1.61035081e-02j,
            0.01244108-5.17635235e-03j, -0.01343395-9.02947047e-03j])

        self.assertTrue(np.allclose(pf, result))

    def testPolarBasis2DEvaluate(self):
        v = np.array([
            0.03380247-5.89204076e-19j,  0.02872018+1.30672514e-02j,
            0.01309842-3.34259247e-04j, -0.02016014-4.67873936e-03j,
            0.03380247-5.89204076e-19j,  0.03057796+9.40057671e-03j,
            0.01371724+4.20376894e-03j, -0.01980004-3.82835342e-04j,
            0.03380247-5.89204076e-19j,  0.03266583+5.03438558e-03j,
            0.01537014+4.89228077e-03j, -0.01025435+1.19682839e-03j,
            0.03380247-5.89204076e-19j,  0.03451127+1.92608768e-04j,
            0.01603935+1.21170869e-03j, -0.00186512-5.87845707e-04j,
            0.03380247-5.89204076e-19j,  0.03592098-4.60817041e-03j,
            0.01385417-3.41016088e-03j, -0.00255115-3.46031202e-03j,
            0.03380247-5.89204076e-19j,  0.03701039-8.82952664e-03j,
            0.01048505-4.55405009e-03j, -0.00468348-1.72639659e-03j,
            0.03380247-5.89204076e-19j,  0.03801901-1.22247975e-02j,
            0.0089058 -1.11094686e-03j, -0.00358214+5.01041279e-03j,
            0.03380247-5.89204076e-19j,  0.03901859-1.49223378e-02j,
            0.01011694+4.00402639e-03j, -0.00313471+1.00359793e-02j,
            0.03380247-5.89204076e-19j,  0.03973949-1.72176019e-02j,
            0.01330573+7.17638522e-03j, -0.00424313+1.02379166e-02j,
            0.03380247-5.89204076e-19j,  0.03966191-1.92649092e-02j,
            0.01689709+7.06696989e-03j, -0.00502319+8.59333664e-03j,
            0.03380247-5.89204076e-19j,  0.03834236-2.09198645e-02j,
            0.01858398+4.84780422e-03j, -0.00470122+7.55674423e-03j,
            0.03380247-5.89204076e-19j,  0.03578453-2.18384167e-02j,
            0.01651114+2.93242588e-03j, -0.00589918+7.01994921e-03j,
            0.03380247-5.89204076e-19j,  0.03258512-2.17359116e-02j,
            0.01207456+3.26106474e-03j, -0.01013553+7.50592900e-03j,
            0.03380247-5.89204076e-19j,  0.02969585-2.05919593e-02j,
            0.00948282+5.52149782e-03j, -0.01143088+9.38150684e-03j,
            0.03380247-5.89204076e-19j,  0.02794545-1.86315376e-02j,
            0.01049781+7.01637729e-03j, -0.009674  +1.06207302e-02j,
            0.03380247-5.89204076e-19j,  0.02767791-1.61035081e-02j,
            0.01244108+5.17635235e-03j, -0.01343395+9.02947047e-03j,
            0.03380247+5.89204076e-19j,  0.02872018-1.30672514e-02j,
            0.01309842+3.34259247e-04j, -0.02016014+4.67873936e-03j,
            0.03380247+5.89204076e-19j,  0.03057796-9.40057671e-03j,
            0.01371724-4.20376894e-03j, -0.01980004+3.82835342e-04j,
            0.03380247+5.89204076e-19j,  0.03266583-5.03438558e-03j,
            0.01537014-4.89228077e-03j, -0.01025435-1.19682839e-03j,
            0.03380247+5.89204076e-19j,  0.03451127-1.92608768e-04j,
            0.01603935-1.21170869e-03j, -0.00186512+5.87845707e-04j,
            0.03380247+5.89204076e-19j,  0.03592098+4.60817041e-03j,
            0.01385417+3.41016088e-03j, -0.00255115+3.46031202e-03j,
            0.03380247+5.89204076e-19j,  0.03701039+8.82952664e-03j,
            0.01048505+4.55405009e-03j, -0.00468348+1.72639659e-03j,
            0.03380247+5.89204076e-19j,  0.03801901+1.22247975e-02j,
            0.0089058 +1.11094686e-03j, -0.00358214-5.01041279e-03j,
            0.03380247+5.89204076e-19j,  0.03901859+1.49223378e-02j,
            0.01011694-4.00402639e-03j, -0.00313471-1.00359793e-02j,
            0.03380247+5.89204076e-19j,  0.03973949+1.72176019e-02j,
            0.01330573-7.17638522e-03j, -0.00424313-1.02379166e-02j,
            0.03380247+5.89204076e-19j,  0.03966191+1.92649092e-02j,
            0.01689709-7.06696989e-03j, -0.00502319-8.59333664e-03j,
            0.03380247+5.89204076e-19j,  0.03834236+2.09198645e-02j,
            0.01858398-4.84780422e-03j, -0.00470122-7.55674423e-03j,
            0.03380247+5.89204076e-19j,  0.03578453+2.18384167e-02j,
            0.01651114-2.93242588e-03j, -0.00589918-7.01994921e-03j,
            0.03380247+5.89204076e-19j,  0.03258512+2.17359116e-02j,
            0.01207456-3.26106474e-03j, -0.01013553-7.50592900e-03j,
            0.03380247+5.89204076e-19j,  0.02969585+2.05919593e-02j,
            0.00948282-5.52149782e-03j, -0.01143088-9.38150684e-03j,
            0.03380247+5.89204076e-19j,  0.02794545+1.86315376e-02j,
            0.01049781-7.01637729e-03j, -0.009674  -1.06207302e-02j,
            0.03380247+5.89204076e-19j,  0.02767791+1.61035081e-02j,
            0.01244108-5.17635235e-03j, -0.01343395-9.02947047e-03j])

        x = self.basis.evaluate(v)
        result = np.array(
            [[0.06439524, 0.05526266, 0.05923557, 0.06839877,
              0.07132814, 0.0700152 , 0.05807745, 0.0383952 ],
             [0.0562731 , 0.06666017, 0.07117394, 0.08286311,
              0.08497253, 0.09705892, 0.09911267, 0.07507809],
             [0.06229429, 0.07975181, 0.08177286, 0.11771731,
              0.13822593, 0.15235741, 0.11580409, 0.09300703],
             [0.07251361, 0.08018075, 0.0945503 , 0.16696323,
              0.18422171, 0.19634707, 0.12920609, 0.09168237],
             [0.07653963, 0.07071338, 0.09301831, 0.19618497,
              0.20674485, 0.20172632, 0.1400457 , 0.09855221],
             [0.07588645, 0.0687121 , 0.06211404, 0.14152617,
              0.17442694, 0.15951065, 0.11124624, 0.09660084],
             [0.07090487, 0.06857491, 0.04449653, 0.05130052,
              0.07608953, 0.07714942, 0.06539296, 0.08355834],
             [0.07749329, 0.0653327 , 0.06345582, 0.05405911,
              0.05502713, 0.05711582, 0.05603395, 0.06482793]]
        )

        self.assertTrue(np.allclose(x, result))
